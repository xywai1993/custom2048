webpackJsonp([0],{fuWP:function(e,t){},lo3l:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i("mvHQ"),a=i.n(r),n={data:function(){return{emptyGrids:null,grids:null,listener:function(){var e=this,t={LEFT:37,UP:38,RIGHT:39,DOWN:40},i=void 0,r=void 0;return{touchstart:function(e){e.preventDefault(),i=e.touches[0].pageX,r=e.touches[0].pageY},touchend:function(t){t.preventDefault();var a=null,n=t.changedTouches[0].pageX,o=t.changedTouches[0].pageY,s=n-i,c=o-r;Math.abs(s)<=5&&Math.abs(c)<=5||(Math.abs(s)>Math.abs(c)?s>0?a="RIGHT":s<0&&(a="LEFT"):Math.abs(s)<Math.abs(c)&&(c>0?a="DOWN":c<0&&(a="UP")),e.$emit("movingtiles",a))},keydown:function(i){switch(i.keyCode){case t.UP:e.$emit("movingtiles","UP");break;case t.RIGHT:e.$emit("movingtiles","RIGHT");break;case t.DOWN:e.$emit("movingtiles","DOWN");break;case t.LEFT:e.$emit("movingtiles","LEFT")}}}}.call(this),canvasRealSize:null,moveable:!1}},methods:{start:function(){var e=this;this.$nextTick(function(){var t=e.canvasRealSize.REAL_WIDTH,i=e.$refs.tiles.getContext("2d");i.clearRect(0,0,t,t),e.grids=JSON.parse(a()(e.emptyGrids)),e.eventListenerSwitch("off"),e.eventListenerSwitch(),e.generateGridNumber(i),e.generateGridNumber(i)})},initChessBoard:function(){var e=this;this.$nextTick(function(){var t=e.canvasRealSize.REAL_WIDTH,i=e.$refs.chessBoard.getContext("2d");i.fillStyle="#bbada0",i.fillRect(0,0,t,t);for(var r=[],a=0;a<4;a++){r[a]=[];for(var n=0;n<4;n++){r[a][n]=null;var o=e.getBoundingClientRect(a,n);e.drawRoundingRect({ctx:i,rect:o})}}e.emptyGrids=r})},drawGameover:function(e){var t=this.canvasRealSize,i=t.REAL_WIDTH,r=t.RATIO;e.fillStyle="rgba(0,0,0,0.6)",e.fillRect(0,0,i,i),e.fillStyle="white",e.font="Microsoft YaHei bold "+60*r+"px";var a=e.measureText("游戏结束");e.fillText("游戏结束",i/2-a.width/2,i/2),this.eventListenerSwitch("off")},drawRoundingRect:function(e){var t=e.ctx,i=e.rect,r=e.radius,a=void 0===r?6:r,n=e.fillStyle,o=void 0===n?"#ccc0b3":n,s=i.left,c=i.right,l=i.top,h=i.bottom;t.fillStyle=o,t.beginPath(),t.moveTo(s,l+a),t.quadraticCurveTo(s,l,s+a,l),t.lineTo(c-a,l),t.quadraticCurveTo(c,l,c,l+a),t.lineTo(c,h-a),t.quadraticCurveTo(c,h,c-a,h),t.lineTo(s+a,h),t.quadraticCurveTo(s,h,s,h-a),t.closePath(),t.fill()},drawGridNumber:function(e,t){var i=t.val,r=t.rect,a=this.getNumberStyle(i),n=a.backgroundColor,o=a.color,s=a.fontSize;this.drawRoundingRect({ctx:e,rect:r,fillStyle:n}),s*=this.canvasRealSize.RATIO,e.fillStyle=o,e.font="bold "+s+"px Microsoft YaHei";var c=e.measureText(i),l=r.left+(r.right-r.left)/2-c.width/2,h=r.bottom-(r.bottom-r.top)/2+s/3;e.fillText(t.val,l,h)},generateGridNumber:function(e){for(var t=this,i=0,r=function(i,r){var a=2*Math.ceil(2*Math.random());t.grids[i][r]={rect:t.getBoundingClientRect(i,r),val:a},t.drawGridNumber(e,t.grids[i][r]),t.$emit("changescore",a)};i<100;){var a=Math.floor(4*Math.random()),n=Math.floor(4*Math.random());if(null===this.grids[a][n]){r(a,n);break}i++}if(100===i)for(var o=0;o<4;o++)for(var s=0;s<4;s++)if(null===this.grids[o][s]){r(o,s);break}},getBoundingClientRect:function(e,t){var i=this.canvasRealSize,r=i.BORDER_WIDTH,a=i.CELL_WIDTH,n=(e+1)*r+a*e,o=(t+1)*r+a*t;return{left:n,top:o,right:n+a,bottom:o+a,height:a,width:a}},getNumberStyle:function(e){var t="black",i="white",r=46;switch(e){case 2:t="#eee4da",i="#776e50";break;case 4:t="#ede0c8",i="#776e50";break;case 8:t="#f2b179";break;case 16:t="#f59563";break;case 32:t="#f67c5f";break;case 64:t="#f65e3b";break;case 128:t="#edcf72",r="32";break;case 256:t="#edcc61",r="32";break;case 512:t="#9c0",r="32";break;case 1024:t="#33b5e5",r="20";break;case 2048:t="#09c",r="20"}return{backgroundColor:t,color:i,fontSize:r}},nospace:function(){for(var e=0;e<4;e++)for(var t=0;t<4;t++)if(null===this.grids[e][t])return!1;return!0},nomoving:function(){for(var e=0;e<4;e++)for(var t=0;t<4;t++){var i=this.grids[e][t];if(e+1<4&&i.val===this.grids[e+1][t].val)return!1;if(t+1<4&&i.val===this.grids[e][t+1].val)return!1}return!0},eventListenerSwitch:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"on";this.$nextTick(function(){var i=e.$refs.tiles;"on"===t?(i.addEventListener("touchstart",e.listener.touchstart,!1),i.addEventListener("touchend",e.listener.touchend,!1),document.addEventListener("keydown",e.listener.keydown,!1)):(i.removeEventListener("touchstart",e.listener.touchstart,!1),i.removeEventListener("touchend",e.listener.touchend,!1),document.removeEventListener("keydown",e.listener.keydown,!1))})},moving:function(e){var t=this,i=this.canvasRealSize.REAL_WIDTH,r=this.$refs.tiles.getContext("2d");if(this.moveable=!1,"RIGHT"===e?this.moveRight():"LEFT"===e?this.moveLeft():"UP"===e?this.moveUp():this.moveDown(),this.moveable){r.clearRect(0,0,i,i);for(var a=0;a<4;a++)for(var n=0;n<4;n++)this.grids[a][n]&&this.drawGridNumber(r,this.grids[a][n]);setTimeout(function(){t.generateGridNumber(r)},200)}!1===this.moveable&&this.nospace()&&this.nomoving()&&this.drawGameover(r)},moveLeft:function(){for(var e=0;e<4;e++)for(var t=0;t<4;t++)for(var i=this.grids[e][t],r=e+1;r<4;){var a=this.mergeTile({currentTile:i,row:e,col:t},{i:r,j:t});if(!0===a)break;i=a,r++}},moveRight:function(){for(var e=3;e>=0;e--)for(var t=0;t<4;t++)for(var i=this.grids[e][t],r=e-1;r>=0;){var a=this.mergeTile({currentTile:i,row:e,col:t},{i:r,j:t});if(!0===a)break;i=a,r--}},moveUp:function(){for(var e=0;e<4;e++)for(var t=0;t<4;t++)for(var i=this.grids[e][t],r=t+1;r<4;){var a=this.mergeTile({currentTile:i,row:e,col:t},{i:e,j:r});if(!0===a)break;i=a,r++}},moveDown:function(){for(var e=0;e<4;e++)for(var t=3;t>=0;t--)for(var i=this.grids[e][t],r=t-1;r>=0;){var a=this.mergeTile({currentTile:i,row:e,col:t},{i:e,j:r});if(!0===a)break;i=a,r--}},mergeTile:function(e,t){var i=e.currentTile,r=e.row,a=e.col,n=t.i,o=t.j,s=!1;return i?this.grids[n][o]&&(this.grids[n][o].val===i.val&&(i.val=2*i.val,this.grids[n][o]=null,this.moveable=!0),s=!0):this.grids[n][o]&&(this.moveable=!0,i=this.grids[n][o],this.grids[n][o]=null),i&&(this.grids[r][a]={val:i.val,rect:this.getBoundingClientRect(r,a)}),!!s||i},initCanvasSize:function(){var e=this;this.$nextTick(function(){var t,i=e.$refs.tiles,r=e.$refs.chessBoard,a=i.width,n=(t=i.getContext("2d"),(window.devicePixelRatio||1)/(t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1)),o=a*n,s=o/5/5,c=o/5;i.width=o,i.height=o,i.style.width=a+"px",i.style.height=a+"px",r.width=o,r.height=o,r.style.width=a+"px",r.style.height=a+"px",e.canvasRealSize={REAL_WIDTH:o,BORDER_WIDTH:s,CELL_WIDTH:c,RATIO:n}})}},mounted:function(){this.initCanvasSize(),this.initChessBoard(),this.$on("movingtiles",this.moving),this.start()}};var o={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"Custom2048"},[t("canvas",{ref:"chessBoard",attrs:{width:"360",height:"360"}}),this._v(" "),t("canvas",{ref:"tiles",attrs:{width:"360",height:"360"}})])},staticRenderFns:[]};var s={components:{Custom2048:i("VU/8")(n,o,!1,function(e){i("fuWP")},null,null).exports},data:function(){return{score:0,maxScore:window.localStorage.getItem("custom2048_score")||0}},watch:{score:function(e){e>this.maxScore&&(this.maxScore=e,window.localStorage.setItem("custom2048_score",e))}},methods:{handleRestart:function(){var e=this;this.$nextTick(function(){e.score=0,e.$refs.custom2048.start()})},handleChangeScore:function(e){this.score+=e},handleGameover:function(){}}},c={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"custom2048-page"},[i("Custom2048",{ref:"custom2048",staticClass:"custom2048-outer-container",on:{changescore:e.handleChangeScore,gameover:e.handleGameover}}),e._v(" "),i("div",{staticClass:"menu-container"},[i("div",{staticClass:"score-container"},[i("div",{staticClass:"block current-score"},[e._v("\n        得分\n        "),i("span",[e._v(e._s(e.score))])]),e._v(" "),i("div",{staticClass:"block history-score"},[e._v("\n        最高分\n        "),i("span",[e._v(e._s(e.maxScore))])])]),e._v(" "),i("span",{staticClass:"block restart",on:{click:e.handleRestart}},[e._v("重新开始")])])],1)},staticRenderFns:[]};var l=i("VU/8")(s,c,!1,function(e){i("yn51")},null,null);t.default=l.exports},mvHQ:function(e,t,i){e.exports={default:i("qkKv"),__esModule:!0}},qkKv:function(e,t,i){var r=i("FeBl"),a=r.JSON||(r.JSON={stringify:JSON.stringify});e.exports=function(e){return a.stringify.apply(a,arguments)}},yn51:function(e,t){}});
//# sourceMappingURL=0.8fd6781a48d49f6a84f7.js.map