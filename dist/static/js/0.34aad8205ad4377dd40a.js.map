{"version":3,"sources":["webpack:///src/components/Custom2048/index.vue","webpack:///./src/components/Custom2048/index.vue?cdb5","webpack:///./src/components/Custom2048/index.vue","webpack:///src/biz/custom2048/index.vue","webpack:///./src/biz/custom2048/index.vue?fa64","webpack:///./src/biz/custom2048/index.vue","webpack:///./node_modules/babel-runtime/core-js/json/stringify.js","webpack:///./node_modules/core-js/library/fn/json/stringify.js"],"names":["Custom2048","data","emptyGrids","grids","listener","_this6","this","KEYDOWN","LEFT","UP","RIGHT","DOWN","startX","startY","touchstart","e","preventDefault","touches","pageX","pageY","touchend","direction","endX","changedTouches","endY","horizontal","vertical","Math","abs","$emit","keydown","keyCode","call","canvasRealSize","moveable","methods","start","_this","$nextTick","REAL_WIDTH","ctx","$refs","tiles","getContext","clearRect","JSON","parse","stringify_default","eventListenerSwitch","generateGridNumber","initChessBoard","_this2","chessBoard","fillStyle","fillRect","i","j","rect","getBoundingClientRect","drawRoundingRect","drawGameover","_canvasRealSize","RATIO","font","text","measureText","fillText","width","options","_options$radius","radius","undefined","_options$fillStyle","left","right","top","bottom","beginPath","moveTo","quadraticCurveTo","lineTo","closePath","fill","drawGridNumber","grid","val","_getNumberStyle","getNumberStyle","backgroundColor","color","fontSize","x","y","row","floor","random","col","ceil","_canvasRealSize2","BORDER_WIDTH","CELL_WIDTH","height","number","nospace","_this3","sw","arguments","length","canvas","addEventListener","document","removeEventListener","moving","_this4","moveRight","moveLeft","moveUp","moveDown","setTimeout","currentTile","i1","mergeTile","ROW","j1","COL","current","neighbor","isMerge","initCanvasSize","_this5","window","devicePixelRatio","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","backingStorePixelRatio","style","mounted","$on","components_Custom2048","render","_h","$createElement","_c","_self","staticClass","ref","attrs","_v","staticRenderFns","custom2048","components","__webpack_require__","normalizeComponent","ssrContext","score","maxScore","localStorage","getItem","watch","setItem","handleRestart","handleChangeScore","awardedMarks","handleGameover","biz_custom2048","_vm","on","changescore","gameover","_s","click","custom2048_Component","custom2048_normalizeComponent","__webpack_exports__","module","exports","default","__esModule","core","$JSON","stringify","it","apply"],"mappings":"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","file":"static/js/0.34aad8205ad4377dd40a.js","sourcesContent":["<template>\n  <div class=\"Custom2048\">\n    <canvas ref=\"chessBoard\" width=\"360\" height=\"360\"></canvas>\n    <canvas ref=\"tiles\" width=\"360\" height=\"360\"></canvas>\n  </div>\n</template>\n<script>\n\nconst ROW = 4\nconst COL = 4\n\n/*\n *  待解决：  1、没有检查canMoving(√)\n *            2、移动端像素比(√)\n *            3、动画效果\n *            4、...\n *\n */\nexport default {\n  data () {\n    return {\n      emptyGrids: null,\n      grids: null,\n      listener: getListener.call(this),\n      canvasRealSize: null,\n      moveable: false\n    }\n  },\n  methods: {\n    start () {\n      this.$nextTick(() => {\n        let {REAL_WIDTH} = this.canvasRealSize\n        let canvas = this.$refs.tiles\n        let ctx = canvas.getContext('2d')\n\n        // 清除tiles\n        ctx.clearRect(0, 0, REAL_WIDTH, REAL_WIDTH)\n        // 初始化grids数组\n        this.grids = JSON.parse(JSON.stringify(this.emptyGrids))\n\n        // 取消事件监听\n        this.eventListenerSwitch('off')\n        // 添加监听事件\n        this.eventListenerSwitch()\n\n        // 随机生成数字\n        this.generateGridNumber(ctx)\n        this.generateGridNumber(ctx)\n      })\n    },\n    initChessBoard () {\n      this.$nextTick(() => {\n        let {REAL_WIDTH} = this.canvasRealSize\n        let chessBoard = this.$refs.chessBoard\n        let ctx = chessBoard.getContext('2d')\n\n        ctx.fillStyle = '#bbada0'\n        ctx.fillRect(0, 0, REAL_WIDTH, REAL_WIDTH)\n        let grids = []\n\n        for (let i = 0; i < ROW; i++) {\n          grids[i] = []\n          for (let j = 0; j < COL; j++) {\n            grids[i][j] = null\n            let rect = this.getBoundingClientRect(i, j)\n            this.drawRoundingRect({ctx, rect})\n          }\n        }\n        this.emptyGrids = grids\n      })\n    },\n    drawGameover (ctx) {\n      let {REAL_WIDTH, RATIO} = this.canvasRealSize\n      let gameoverText = '游戏结束'\n      ctx.fillStyle = 'rgba(0,0,0,0.6)'\n      ctx.fillRect(0, 0, REAL_WIDTH, REAL_WIDTH)\n      ctx.fillStyle = 'white'\n      ctx.font = `Microsoft YaHei bold ${60 * RATIO}px`\n      let text = ctx.measureText(gameoverText)\n      ctx.fillText(gameoverText, REAL_WIDTH / 2 - text.width / 2, REAL_WIDTH / 2)\n      this.eventListenerSwitch('off')\n    },\n    drawRoundingRect (options) {\n      // 圆角矩形...\n      let {ctx, rect, radius = 6, fillStyle = '#ccc0b3'} = options\n      let {left, right, top, bottom} = rect\n      ctx.fillStyle = fillStyle\n      ctx.beginPath()\n      ctx.moveTo(left, top + radius)\n      ctx.quadraticCurveTo(left, top, left + radius, top)\n      ctx.lineTo(right - radius, top)\n      ctx.quadraticCurveTo(right, top, right, top + radius)\n      ctx.lineTo(right, bottom - radius)\n      ctx.quadraticCurveTo(right, bottom, right - radius, bottom)\n      ctx.lineTo(left + radius, bottom)\n      ctx.quadraticCurveTo(left, bottom, left, bottom - radius)\n      ctx.closePath()\n      ctx.fill()\n    },\n    drawGridNumber (ctx, grid) {\n      let {val, rect} = grid\n      let {backgroundColor, color, fontSize} = this.getNumberStyle(val)\n\n      this.drawRoundingRect({ctx, rect, fillStyle: backgroundColor})\n      fontSize = fontSize * this.canvasRealSize.RATIO\n      // draw text\n      ctx.fillStyle = color\n      ctx.font = `bold ${fontSize}px Microsoft YaHei`\n      let text = ctx.measureText(val)\n      let x = rect.left + (rect.right - rect.left) / 2 - text.width / 2\n      let y = rect.bottom - (rect.bottom - rect.top) / 2 + fontSize / 3\n      ctx.fillText(grid.val, x, y)\n    },\n    generateGridNumber (ctx) {\n      while (true) {\n        let row = Math.floor(Math.random() * ROW)\n        let col = Math.floor(Math.random() * COL)\n        if (this.grids[row][col] === null) {\n          let val = Math.ceil(Math.random() * 2) * 2\n          this.grids[row][col] = {\n            rect: this.getBoundingClientRect(row, col),\n            val\n          }\n          this.drawGridNumber(ctx, this.grids[row][col])\n\n          this.$emit('changescore', val)\n          break\n        }\n      }\n    },\n    getBoundingClientRect (row, col) {\n      let {BORDER_WIDTH, CELL_WIDTH} = this.canvasRealSize\n      let left = (row + 1) * BORDER_WIDTH + CELL_WIDTH * row\n      let top = (col + 1) * BORDER_WIDTH + CELL_WIDTH * col\n      return {\n        left,\n        top,\n        right: left + CELL_WIDTH,\n        bottom: top + CELL_WIDTH,\n        height: CELL_WIDTH,\n        width: CELL_WIDTH\n      }\n    },\n    getNumberStyle (number) {\n      let backgroundColor = 'black'\n      let color = 'white'\n      let fontSize = 46\n      switch (number) {\n        case 2:\n          backgroundColor = '#eee4da'\n          color = '#776e50'\n          break\n        case 4:\n          backgroundColor = '#ede0c8'\n          color = '#776e50'\n          break\n        case 8:\n          backgroundColor = '#f2b179'\n          break\n        case 16:\n          backgroundColor = '#f59563'\n          break\n        case 32:\n          backgroundColor = '#f67c5f'\n          break\n        case 64:\n          backgroundColor = '#f65e3b'\n          break\n        case 128:\n          backgroundColor = '#edcf72'\n          fontSize = '32'\n          break\n        case 256:\n          backgroundColor = '#edcc61'\n          fontSize = '32'\n          break\n        case 512:\n          backgroundColor = '#9c0'\n          fontSize = '32'\n          break\n        case 1024:\n          backgroundColor = '#33b5e5'\n          fontSize = '20'\n          break\n        case 2048:\n          backgroundColor = '#09c'\n          fontSize = '20'\n          break\n      }\n      return {\n        backgroundColor,\n        color,\n        fontSize\n      }\n    },\n    nospace () {\n      for (let i = 0; i < ROW; i++) {\n        for (let j = 0; j < COL; j++) {\n          if (this.grids[i][j] === null) {\n            return false\n          }\n        }\n      }\n      return true\n    },\n    eventListenerSwitch (sw = 'on') {\n      this.$nextTick(() => {\n        let canvas = this.$refs.tiles\n        if (sw === 'on') {\n          canvas.addEventListener('touchstart', this.listener.touchstart, false)\n          canvas.addEventListener('touchend', this.listener.touchend, false)\n          document.addEventListener('keydown', this.listener.keydown, false)\n        } else {\n          canvas.removeEventListener('touchstart', this.listener.touchstart, false)\n          canvas.removeEventListener('touchend', this.listener.touchend, false)\n          document.removeEventListener('keydown', this.listener.keydown, false)\n        }\n      })\n    },\n    moving (direction) {\n      let {REAL_WIDTH} = this.canvasRealSize\n      let ctx = this.$refs.tiles.getContext('2d')\n\n      if (this.nospace()) {\n        this.drawGameover(ctx)\n        return\n      }\n\n      this.moveable = false\n      if (direction === 'RIGHT') {\n        this.moveRight()\n      } else if (direction === 'LEFT') {\n        this.moveLeft()\n      } else if (direction === 'UP') {\n        this.moveUp()\n      } else {\n        this.moveDown()\n      }\n\n      if (this.moveable) {\n        ctx.clearRect(0, 0, REAL_WIDTH, REAL_WIDTH)\n        for (let i = 0; i < ROW; i++) {\n          for (let j = 0; j < COL; j++) {\n            if (this.grids[i][j]) {\n              this.drawGridNumber(ctx, this.grids[i][j])\n            }\n          }\n        }\n        setTimeout(() => {\n          this.generateGridNumber(ctx)\n        }, 200)\n      }\n    },\n\n    moveLeft () {\n      for (let i = 0; i < ROW; i++) {\n        for (let j = 0; j < COL; j++) {\n          let currentTile = this.grids[i][j]\n          let i1 = i + 1\n          while (i1 < ROW) {\n            let mergeTile = this.mergeTile({currentTile, row: i, col: j}, {i: i1, j})\n            if (mergeTile === true) {\n              break\n            } else {\n              currentTile = mergeTile\n              i1++\n            }\n          }\n        }\n      }\n    },\n    moveRight () {\n      for (let i = ROW - 1; i >= 0; i--) {\n        for (let j = 0; j < COL; j++) {\n          let currentTile = this.grids[i][j]\n          let i1 = i - 1\n          while (i1 >= 0) {\n            let mergeTile = this.mergeTile({currentTile, row: i, col: j}, {i: i1, j})\n            if (mergeTile === true) {\n              break\n            } else {\n              currentTile = mergeTile\n              i1--\n            }\n          }\n        }\n      }\n    },\n    moveUp () {\n      for (let i = 0; i < ROW; i++) {\n        for (let j = 0; j < COL; j++) {\n          let currentTile = this.grids[i][j]\n          let j1 = j + 1\n          while (j1 < COL) {\n            let mergeTile = this.mergeTile({currentTile, row: i, col: j}, {i, j: j1})\n            if (mergeTile === true) {\n              break\n            } else {\n              currentTile = mergeTile\n              j1++\n            }\n          }\n        }\n      }\n    },\n    moveDown () {\n      for (let i = 0; i < ROW; i++) {\n        for (let j = COL - 1; j >= 0; j--) {\n          let currentTile = this.grids[i][j]\n          let j1 = j - 1\n          while (j1 >= 0) {\n            let mergeTile = this.mergeTile({currentTile, row: i, col: j}, {i, j: j1})\n            if (mergeTile === true) {\n              break\n            } else {\n              currentTile = mergeTile\n              j1--\n            }\n          }\n        }\n      }\n    },\n    mergeTile (current, neighbor) {\n      let {currentTile, row, col} = current\n      let {i, j} = neighbor\n      let isMerge = false\n      if (currentTile) {\n        if (this.grids[i][j]) {\n          if (this.grids[i][j].val === currentTile.val) {\n            currentTile.val = currentTile.val * 2\n            this.grids[i][j] = null\n            this.moveable = true\n          }\n          isMerge = true\n        }\n      } else if (this.grids[i][j]) {\n        this.moveable = true\n        currentTile = this.grids[i][j]\n        this.grids[i][j] = null\n      }\n      if (currentTile) {\n        this.grids[row][col] = {\n          val: currentTile.val,\n          rect: this.getBoundingClientRect(row, col)\n        }\n      }\n      if (isMerge) {\n        return true\n      }\n      return currentTile\n    },\n    initCanvasSize () {\n      this.$nextTick(() => {\n        let tiles = this.$refs.tiles\n        let chessBoard = this.$refs.chessBoard\n\n        let width = tiles.width\n        let RATIO = (() => {\n          let ctx = tiles.getContext('2d')\n          let dpr = window.devicePixelRatio || 1\n          let bsr = ctx.webkitBackingStorePixelRatio ||\n                    ctx.mozBackingStorePixelRatio ||\n                    ctx.msBackingStorePixelRatio ||\n                    ctx.oBackingStorePixelRatio ||\n                    ctx.backingStorePixelRatio || 1\n          return dpr / bsr\n        })()\n        let REAL_WIDTH = width * RATIO\n        let BORDER_WIDTH = REAL_WIDTH / 5 / 5\n        let CELL_WIDTH = REAL_WIDTH / 5\n\n        // 初始化$tiles的大小\n        tiles.width = REAL_WIDTH\n        tiles.height = REAL_WIDTH\n        tiles.style.width = width + 'px'\n        tiles.style.height = width + 'px'\n\n        // 初始化$chessBoard的大小\n        chessBoard.width = REAL_WIDTH\n        chessBoard.height = REAL_WIDTH\n        chessBoard.style.width = width + 'px'\n        chessBoard.style.height = width + 'px'\n\n        this.canvasRealSize = {\n          REAL_WIDTH,\n          BORDER_WIDTH,\n          CELL_WIDTH,\n          RATIO\n        }\n      })\n    }\n  },\n  mounted () {\n    this.initCanvasSize()\n    this.initChessBoard()\n    this.$on('movingtiles', this.moving)\n\n    // 开始游戏\n    this.start()\n  }\n}\nfunction getListener () {\n  const KEYDOWN = {\n    LEFT: 37,\n    UP: 38,\n    RIGHT: 39,\n    DOWN: 40\n  }\n  let startX, startY\n  return {\n    touchstart: (e) => {\n      // 防止滑动时，移动端页面上下抖动\n      e.preventDefault()\n      startX = e.touches[0].pageX\n      startY = e.touches[0].pageY\n    },\n    touchend: (e) => {\n      e.preventDefault()\n\n      let direction = null\n      let endX = e.changedTouches[0].pageX\n      let endY = e.changedTouches[0].pageY\n      let horizontal = endX - startX\n      let vertical = endY - startY\n      // 当touchend坐标偏移小于5像素时，不触发movingtiles事件。\n      if (Math.abs(horizontal) <= 5 && Math.abs(vertical) <= 5) {\n        return\n      }\n      if (Math.abs(horizontal) > Math.abs(vertical)) {\n        if (horizontal > 0) {\n          direction = 'RIGHT'\n        } else if (horizontal < 0) {\n          direction = 'LEFT'\n        }\n      } else if (Math.abs(horizontal) < Math.abs(vertical)) {\n        if (vertical > 0) {\n          direction = 'DOWN'\n        } else if (vertical < 0) {\n          direction = 'UP'\n        }\n      }\n      this.$emit('movingtiles', direction)\n    },\n    keydown: (e) => {\n      switch (e.keyCode) {\n        case KEYDOWN.UP:\n          this.$emit('movingtiles', 'UP')\n          break\n        case KEYDOWN.RIGHT:\n          this.$emit('movingtiles', 'RIGHT')\n          break\n        case KEYDOWN.DOWN:\n          this.$emit('movingtiles', 'DOWN')\n          break\n        case KEYDOWN.LEFT:\n          this.$emit('movingtiles', 'LEFT')\n          break\n      }\n    }\n  }\n}\n</script>\n<style lang=\"less\">\n  .Custom2048 {\n    canvas {\n      position: absolute;\n      top: 120px;\n      left: 50%;\n      transform: translateX(-50%);\n      display: block;\n      border-radius: 6px;\n    }\n  }\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/components/Custom2048/index.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"Custom2048\"},[_c('canvas',{ref:\"chessBoard\",attrs:{\"width\":\"360\",\"height\":\"360\"}}),_vm._v(\" \"),_c('canvas',{ref:\"tiles\",attrs:{\"width\":\"360\",\"height\":\"360\"}})])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-ded71c40\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/Custom2048/index.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-ded71c40\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!less-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./index.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./index.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./index.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-ded71c40\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./index.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/Custom2048/index.vue\n// module id = null\n// module chunks = ","<template>\n  <div class=\"custom2048-page\">\n    <Custom2048\n      ref=\"custom2048\"\n      class=\"custom2048-outer-container\"\n      @changescore=\"handleChangeScore\"\n      @gameover=\"handleGameover\"></Custom2048>\n    <div class=\"menu-container\">\n      <div class=\"score-container\">\n        <div class=\"block current-score\">\n          得分\n          <span>{{score}}</span>\n        </div>\n        <div class=\"block history-score\">\n          最高分\n          <span>{{maxScore}}</span>\n        </div>\n      </div>\n      <span class=\"block restart\" @click=\"handleRestart\">重新开始</span>\n    </div>\n  </div>\n</template>\n\n<script>\nimport Custom2048 from 'components/Custom2048'\n\nexport default {\n  components: {\n    Custom2048\n  },\n  data () {\n    return {\n      score: 0,\n      maxScore: window.localStorage.getItem('custom2048_score') || 0\n    }\n  },\n  watch: {\n    score (val) {\n      if (val > this.maxScore) {\n        this.maxScore = val\n        window.localStorage.setItem('custom2048_score', val)\n      }\n    }\n  },\n  methods: {\n    handleRestart () {\n      this.$nextTick(() => {\n        this.score = 0\n        this.$refs.custom2048.start()\n      })\n    },\n    handleChangeScore (awardedMarks) {\n      this.score += awardedMarks\n    },\n    handleGameover () {\n\n    }\n  }\n}\n</script>\n\n<style lang=\"less\">\n  .custom2048-page {\n    height: 100%;\n    font-family: 'Microsoft YaHei';\n    background-color: #faf8ef;\n    .menu-container {\n      width: 300px;\n      margin: 0 auto;\n      text-align: right;\n    }\n    .block {\n      display: inline-block;\n      padding: 3px 12px;\n      height: 2;\n      text-align: center;\n      background-color: #8f7a66;\n      color: #f9f6f2;\n      border-radius: 6px;\n      font-size: 18px;\n      margin: 5px;\n    }\n    .score-container .block {\n      color: rgba(255,255,255,0.6);\n      font-size: 14px;\n      width: 48px;\n      background-color: rgba(143, 122, 102, .8);\n      span {\n        display: block;\n        color: white;\n      }\n    }\n    .restart {\n      width: 134px;\n      height: 36px;\n      line-height: 36px;\n      background-color: #d4430f;\n      &:active {\n        opacity: 0.8;\n      }\n    }\n  }\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/biz/custom2048/index.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"custom2048-page\"},[_c('Custom2048',{ref:\"custom2048\",staticClass:\"custom2048-outer-container\",on:{\"changescore\":_vm.handleChangeScore,\"gameover\":_vm.handleGameover}}),_vm._v(\" \"),_c('div',{staticClass:\"menu-container\"},[_c('div',{staticClass:\"score-container\"},[_c('div',{staticClass:\"block current-score\"},[_vm._v(\"\\n        得分\\n        \"),_c('span',[_vm._v(_vm._s(_vm.score))])]),_vm._v(\" \"),_c('div',{staticClass:\"block history-score\"},[_vm._v(\"\\n        最高分\\n        \"),_c('span',[_vm._v(_vm._s(_vm.maxScore))])])]),_vm._v(\" \"),_c('span',{staticClass:\"block restart\",on:{\"click\":_vm.handleRestart}},[_vm._v(\"重新开始\")])])],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-25632522\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/biz/custom2048/index.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-25632522\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!less-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./index.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./index.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./index.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-25632522\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./index.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/biz/custom2048/index.vue\n// module id = null\n// module chunks = ","module.exports = { \"default\": require(\"core-js/library/fn/json/stringify\"), __esModule: true };\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/babel-runtime/core-js/json/stringify.js\n// module id = mvHQ\n// module chunks = 0","var core = require('../../modules/_core');\nvar $JSON = core.JSON || (core.JSON = { stringify: JSON.stringify });\nmodule.exports = function stringify(it) { // eslint-disable-line no-unused-vars\n  return $JSON.stringify.apply($JSON, arguments);\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/library/fn/json/stringify.js\n// module id = qkKv\n// module chunks = 0"],"sourceRoot":""}